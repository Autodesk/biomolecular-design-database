/* eslint max-len: 0 */

// PostgreSQL Table Builder & Compiler
// -------

'use strict';

exports.__esModule = true;

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

var _inherits = require('inherits');

var _inherits2 = _interopRequireDefault(_inherits);

var _schemaTablecompiler = require('../../../schema/tablecompiler');

var _schemaTablecompiler2 = _interopRequireDefault(_schemaTablecompiler);

var _lodash = require('lodash');

function TableCompiler_PG() {
  _schemaTablecompiler2['default'].apply(this, arguments);
}
_inherits2['default'](TableCompiler_PG, _schemaTablecompiler2['default']);

// Compile a rename column command.
TableCompiler_PG.prototype.renameColumn = function (from, to) {
  return this.pushQuery({
    sql: 'alter table ' + this.tableName() + ' rename ' + this.formatter.wrap(from) + ' to ' + this.formatter.wrap(to)
  });
};

TableCompiler_PG.prototype.compileAdd = function (builder) {
  var table = this.formatter.wrap(builder);
  var columns = this.prefixArray('add column', this.getColumns(builder));
  return this.pushQuery({
    sql: 'alter table ' + table + ' ' + columns.join(', ')
  });
};

// Adds the "create" query to the query sequence.
TableCompiler_PG.prototype.createQuery = function (columns, ifNot) {
  var createStatement = ifNot ? 'create table if not exists ' : 'create table ';
  var sql = createStatement + this.tableName() + ' (' + columns.sql.join(', ') + ')';
  if (this.single.inherits) sql += ' inherits (' + this.formatter.wrap(this.single.inherits) + ')';
  this.pushQuery({
    sql: sql,
    bindings: columns.bindings
  });
  var hasComment = _lodash.has(this.single, 'comment');
  if (hasComment) this.comment(this.single.comment);
};

// Compiles the comment on the table.
TableCompiler_PG.prototype.comment = function (comment) {
  this.pushQuery('comment on table ' + this.tableName() + ' is \'' + (this.single.comment || '') + '\'');
};

// Indexes:
// -------

TableCompiler_PG.prototype.primary = function (columns, constraintName) {
  constraintName = constraintName ? this.formatter.wrap(constraintName) : this.formatter.wrap(this.tableNameRaw + '_pkey');
  this.pushQuery('alter table ' + this.tableName() + ' add constraint ' + constraintName + ' primary key (' + this.formatter.columnize(columns) + ')');
};
TableCompiler_PG.prototype.unique = function (columns, indexName) {
  indexName = indexName ? this.formatter.wrap(indexName) : this._indexCommand('unique', this.tableNameRaw, columns);
  this.pushQuery('alter table ' + this.tableName() + ' add constraint ' + indexName + ' unique (' + this.formatter.columnize(columns) + ')');
};
TableCompiler_PG.prototype.index = function (columns, indexName, indexType) {
  indexName = indexName ? this.formatter.wrap(indexName) : this._indexCommand('index', this.tableNameRaw, columns);
  this.pushQuery('create index ' + indexName + ' on ' + this.tableName() + (indexType && ' using ' + indexType || '') + ' (' + this.formatter.columnize(columns) + ')');
};
TableCompiler_PG.prototype.dropPrimary = function (constraintName) {
  constraintName = constraintName ? this.formatter.wrap(constraintName) : this.formatter.wrap(this.tableNameRaw + '_pkey');
  this.pushQuery('alter table ' + this.tableName() + ' drop constraint ' + constraintName);
};
TableCompiler_PG.prototype.dropIndex = function (columns, indexName) {
  indexName = indexName ? this.formatter.wrap(indexName) : this._indexCommand('index', this.tableNameRaw, columns);
  this.pushQuery('drop index ' + indexName);
};
TableCompiler_PG.prototype.dropUnique = function (columns, indexName) {
  indexName = indexName ? this.formatter.wrap(indexName) : this._indexCommand('unique', this.tableNameRaw, columns);
  this.pushQuery('alter table ' + this.tableName() + ' drop constraint ' + indexName);
};
TableCompiler_PG.prototype.dropForeign = function (columns, indexName) {
  indexName = indexName ? this.formatter.wrap(indexName) : this._indexCommand('foreign', this.tableNameRaw, columns);
  this.pushQuery('alter table ' + this.tableName() + ' drop constraint ' + indexName);
};

exports['default'] = TableCompiler_PG;
module.exports = exports['default'];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9kaWFsZWN0cy9wb3N0Z3Jlcy9zY2hlbWEvdGFibGVjb21waWxlci5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozt3QkFLcUIsVUFBVTs7OzttQ0FDTCwrQkFBK0I7Ozs7c0JBRXJDLFFBQVE7O0FBRTVCLFNBQVMsZ0JBQWdCLEdBQUc7QUFDMUIsbUNBQWMsS0FBSyxDQUFDLElBQUksRUFBRSxTQUFTLENBQUMsQ0FBQztDQUN0QztBQUNELHNCQUFTLGdCQUFnQixtQ0FBZ0IsQ0FBQzs7O0FBRzFDLGdCQUFnQixDQUFDLFNBQVMsQ0FBQyxZQUFZLEdBQUcsVUFBUyxJQUFJLEVBQUUsRUFBRSxFQUFFO0FBQzNELFNBQU8sSUFBSSxDQUFDLFNBQVMsQ0FBQztBQUNwQixPQUFHLG1CQUFpQixJQUFJLENBQUMsU0FBUyxFQUFFLGdCQUFXLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxZQUFPLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxBQUFFO0dBQ3pHLENBQUMsQ0FBQztDQUNKLENBQUM7O0FBRUYsZ0JBQWdCLENBQUMsU0FBUyxDQUFDLFVBQVUsR0FBRyxVQUFTLE9BQU8sRUFBRTtBQUN4RCxNQUFNLEtBQUssR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztBQUMzQyxNQUFNLE9BQU8sR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDLFlBQVksRUFBRSxJQUFJLENBQUMsVUFBVSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7QUFDekUsU0FBTyxJQUFJLENBQUMsU0FBUyxDQUFDO0FBQ3BCLE9BQUcsbUJBQWlCLEtBQUssU0FBSSxPQUFPLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxBQUFFO0dBQ2xELENBQUMsQ0FBQztDQUNKLENBQUM7OztBQUdGLGdCQUFnQixDQUFDLFNBQVMsQ0FBQyxXQUFXLEdBQUcsVUFBUyxPQUFPLEVBQUUsS0FBSyxFQUFFO0FBQ2hFLE1BQU0sZUFBZSxHQUFHLEtBQUssR0FBRyw2QkFBNkIsR0FBRyxlQUFlLENBQUM7QUFDaEYsTUFBSSxHQUFHLEdBQUcsZUFBZSxHQUFHLElBQUksQ0FBQyxTQUFTLEVBQUUsR0FBRyxJQUFJLEdBQUcsT0FBTyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsR0FBRyxDQUFDO0FBQ25GLE1BQUksSUFBSSxDQUFDLE1BQU0sQ0FBQyxRQUFRLEVBQUUsR0FBRyxvQkFBa0IsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsTUFBRyxDQUFDO0FBQzVGLE1BQUksQ0FBQyxTQUFTLENBQUM7QUFDYixPQUFHLEVBQUgsR0FBRztBQUNILFlBQVEsRUFBRSxPQUFPLENBQUMsUUFBUTtHQUMzQixDQUFDLENBQUM7QUFDSCxNQUFNLFVBQVUsR0FBRyxZQUFJLElBQUksQ0FBQyxNQUFNLEVBQUUsU0FBUyxDQUFDLENBQUM7QUFDL0MsTUFBSSxVQUFVLEVBQUUsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDO0NBQ25ELENBQUM7OztBQUdGLGdCQUFnQixDQUFDLFNBQVMsQ0FBQyxPQUFPLEdBQUcsVUFBUyxPQUFPLEVBQUU7QUFDckQsTUFBSSxDQUFDLFNBQVMsdUJBQXFCLElBQUksQ0FBQyxTQUFTLEVBQUUsZUFBUSxJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sSUFBSSxFQUFFLENBQUEsUUFBSSxDQUFDO0NBQzFGLENBQUM7Ozs7O0FBS0YsZ0JBQWdCLENBQUMsU0FBUyxDQUFDLE9BQU8sR0FBRyxVQUFTLE9BQU8sRUFBRSxjQUFjLEVBQUU7QUFDckUsZ0JBQWMsR0FBRyxjQUFjLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUksSUFBSSxDQUFDLFlBQVksV0FBUSxDQUFDO0FBQ3pILE1BQUksQ0FBQyxTQUFTLGtCQUFnQixJQUFJLENBQUMsU0FBUyxFQUFFLHdCQUFtQixjQUFjLHNCQUFpQixJQUFJLENBQUMsU0FBUyxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUMsT0FBSSxDQUFDO0NBQ3ZJLENBQUM7QUFDRixnQkFBZ0IsQ0FBQyxTQUFTLENBQUMsTUFBTSxHQUFHLFVBQVMsT0FBTyxFQUFFLFNBQVMsRUFBRTtBQUMvRCxXQUFTLEdBQUcsU0FBUyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxHQUFHLElBQUksQ0FBQyxhQUFhLENBQUMsUUFBUSxFQUFFLElBQUksQ0FBQyxZQUFZLEVBQUUsT0FBTyxDQUFDLENBQUM7QUFDbEgsTUFBSSxDQUFDLFNBQVMsQ0FBQyxpQkFBZSxJQUFJLENBQUMsU0FBUyxFQUFFLHdCQUFtQixTQUFTLEdBQ3hFLFdBQVcsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQztDQUMxRCxDQUFDO0FBQ0YsZ0JBQWdCLENBQUMsU0FBUyxDQUFDLEtBQUssR0FBRyxVQUFTLE9BQU8sRUFBRSxTQUFTLEVBQUUsU0FBUyxFQUFFO0FBQ3pFLFdBQVMsR0FBRyxTQUFTLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsSUFBSSxDQUFDLGFBQWEsQ0FBQyxPQUFPLEVBQUUsSUFBSSxDQUFDLFlBQVksRUFBRSxPQUFPLENBQUMsQ0FBQztBQUNqSCxNQUFJLENBQUMsU0FBUyxDQUFDLGtCQUFnQixTQUFTLFlBQU8sSUFBSSxDQUFDLFNBQVMsRUFBRSxJQUFHLFNBQVMsZ0JBQWUsU0FBUyxBQUFHLElBQUksRUFBRSxDQUFBLEdBQzFHLElBQUksR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQztDQUNuRCxDQUFDO0FBQ0YsZ0JBQWdCLENBQUMsU0FBUyxDQUFDLFdBQVcsR0FBRyxVQUFTLGNBQWMsRUFBRTtBQUNoRSxnQkFBYyxHQUFHLGNBQWMsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsWUFBWSxHQUFHLE9BQU8sQ0FBQyxDQUFDO0FBQ3pILE1BQUksQ0FBQyxTQUFTLGtCQUFnQixJQUFJLENBQUMsU0FBUyxFQUFFLHlCQUFvQixjQUFjLENBQUcsQ0FBQztDQUNyRixDQUFDO0FBQ0YsZ0JBQWdCLENBQUMsU0FBUyxDQUFDLFNBQVMsR0FBRyxVQUFTLE9BQU8sRUFBRSxTQUFTLEVBQUU7QUFDbEUsV0FBUyxHQUFHLFNBQVMsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDLE9BQU8sRUFBRSxJQUFJLENBQUMsWUFBWSxFQUFFLE9BQU8sQ0FBQyxDQUFDO0FBQ2pILE1BQUksQ0FBQyxTQUFTLGlCQUFlLFNBQVMsQ0FBRyxDQUFDO0NBQzNDLENBQUM7QUFDRixnQkFBZ0IsQ0FBQyxTQUFTLENBQUMsVUFBVSxHQUFHLFVBQVMsT0FBTyxFQUFFLFNBQVMsRUFBRTtBQUNuRSxXQUFTLEdBQUcsU0FBUyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxHQUFHLElBQUksQ0FBQyxhQUFhLENBQUMsUUFBUSxFQUFFLElBQUksQ0FBQyxZQUFZLEVBQUUsT0FBTyxDQUFDLENBQUM7QUFDbEgsTUFBSSxDQUFDLFNBQVMsa0JBQWdCLElBQUksQ0FBQyxTQUFTLEVBQUUseUJBQW9CLFNBQVMsQ0FBRyxDQUFDO0NBQ2hGLENBQUM7QUFDRixnQkFBZ0IsQ0FBQyxTQUFTLENBQUMsV0FBVyxHQUFHLFVBQVMsT0FBTyxFQUFFLFNBQVMsRUFBRTtBQUNwRSxXQUFTLEdBQUcsU0FBUyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxHQUFHLElBQUksQ0FBQyxhQUFhLENBQUMsU0FBUyxFQUFFLElBQUksQ0FBQyxZQUFZLEVBQUUsT0FBTyxDQUFDLENBQUM7QUFDbkgsTUFBSSxDQUFDLFNBQVMsa0JBQWdCLElBQUksQ0FBQyxTQUFTLEVBQUUseUJBQW9CLFNBQVMsQ0FBRyxDQUFDO0NBQ2hGLENBQUM7O3FCQUVhLGdCQUFnQiIsImZpbGUiOiJ0YWJsZWNvbXBpbGVyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyogZXNsaW50IG1heC1sZW46IDAgKi9cblxuLy8gUG9zdGdyZVNRTCBUYWJsZSBCdWlsZGVyICYgQ29tcGlsZXJcbi8vIC0tLS0tLS1cblxuaW1wb3J0IGluaGVyaXRzIGZyb20gJ2luaGVyaXRzJztcbmltcG9ydCBUYWJsZUNvbXBpbGVyIGZyb20gJy4uLy4uLy4uL3NjaGVtYS90YWJsZWNvbXBpbGVyJztcblxuaW1wb3J0IHsgaGFzIH0gZnJvbSAnbG9kYXNoJ1xuXG5mdW5jdGlvbiBUYWJsZUNvbXBpbGVyX1BHKCkge1xuICBUYWJsZUNvbXBpbGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG59XG5pbmhlcml0cyhUYWJsZUNvbXBpbGVyX1BHLCBUYWJsZUNvbXBpbGVyKTtcblxuLy8gQ29tcGlsZSBhIHJlbmFtZSBjb2x1bW4gY29tbWFuZC5cblRhYmxlQ29tcGlsZXJfUEcucHJvdG90eXBlLnJlbmFtZUNvbHVtbiA9IGZ1bmN0aW9uKGZyb20sIHRvKSB7XG4gIHJldHVybiB0aGlzLnB1c2hRdWVyeSh7XG4gICAgc3FsOiBgYWx0ZXIgdGFibGUgJHt0aGlzLnRhYmxlTmFtZSgpfSByZW5hbWUgJHt0aGlzLmZvcm1hdHRlci53cmFwKGZyb20pfSB0byAke3RoaXMuZm9ybWF0dGVyLndyYXAodG8pfWBcbiAgfSk7XG59O1xuXG5UYWJsZUNvbXBpbGVyX1BHLnByb3RvdHlwZS5jb21waWxlQWRkID0gZnVuY3Rpb24oYnVpbGRlcikge1xuICBjb25zdCB0YWJsZSA9IHRoaXMuZm9ybWF0dGVyLndyYXAoYnVpbGRlcik7XG4gIGNvbnN0IGNvbHVtbnMgPSB0aGlzLnByZWZpeEFycmF5KCdhZGQgY29sdW1uJywgdGhpcy5nZXRDb2x1bW5zKGJ1aWxkZXIpKTtcbiAgcmV0dXJuIHRoaXMucHVzaFF1ZXJ5KHtcbiAgICBzcWw6IGBhbHRlciB0YWJsZSAke3RhYmxlfSAke2NvbHVtbnMuam9pbignLCAnKX1gXG4gIH0pO1xufTtcblxuLy8gQWRkcyB0aGUgXCJjcmVhdGVcIiBxdWVyeSB0byB0aGUgcXVlcnkgc2VxdWVuY2UuXG5UYWJsZUNvbXBpbGVyX1BHLnByb3RvdHlwZS5jcmVhdGVRdWVyeSA9IGZ1bmN0aW9uKGNvbHVtbnMsIGlmTm90KSB7XG4gIGNvbnN0IGNyZWF0ZVN0YXRlbWVudCA9IGlmTm90ID8gJ2NyZWF0ZSB0YWJsZSBpZiBub3QgZXhpc3RzICcgOiAnY3JlYXRlIHRhYmxlICc7XG4gIGxldCBzcWwgPSBjcmVhdGVTdGF0ZW1lbnQgKyB0aGlzLnRhYmxlTmFtZSgpICsgJyAoJyArIGNvbHVtbnMuc3FsLmpvaW4oJywgJykgKyAnKSc7XG4gIGlmICh0aGlzLnNpbmdsZS5pbmhlcml0cykgc3FsICs9IGAgaW5oZXJpdHMgKCR7dGhpcy5mb3JtYXR0ZXIud3JhcCh0aGlzLnNpbmdsZS5pbmhlcml0cyl9KWA7XG4gIHRoaXMucHVzaFF1ZXJ5KHtcbiAgICBzcWwsXG4gICAgYmluZGluZ3M6IGNvbHVtbnMuYmluZGluZ3NcbiAgfSk7XG4gIGNvbnN0IGhhc0NvbW1lbnQgPSBoYXModGhpcy5zaW5nbGUsICdjb21tZW50Jyk7XG4gIGlmIChoYXNDb21tZW50KSB0aGlzLmNvbW1lbnQodGhpcy5zaW5nbGUuY29tbWVudCk7XG59O1xuXG4vLyBDb21waWxlcyB0aGUgY29tbWVudCBvbiB0aGUgdGFibGUuXG5UYWJsZUNvbXBpbGVyX1BHLnByb3RvdHlwZS5jb21tZW50ID0gZnVuY3Rpb24oY29tbWVudCkge1xuICB0aGlzLnB1c2hRdWVyeShgY29tbWVudCBvbiB0YWJsZSAke3RoaXMudGFibGVOYW1lKCl9IGlzICcke3RoaXMuc2luZ2xlLmNvbW1lbnQgfHwgJyd9J2ApO1xufTtcblxuLy8gSW5kZXhlczpcbi8vIC0tLS0tLS1cblxuVGFibGVDb21waWxlcl9QRy5wcm90b3R5cGUucHJpbWFyeSA9IGZ1bmN0aW9uKGNvbHVtbnMsIGNvbnN0cmFpbnROYW1lKSB7XG4gIGNvbnN0cmFpbnROYW1lID0gY29uc3RyYWludE5hbWUgPyB0aGlzLmZvcm1hdHRlci53cmFwKGNvbnN0cmFpbnROYW1lKSA6IHRoaXMuZm9ybWF0dGVyLndyYXAoYCR7dGhpcy50YWJsZU5hbWVSYXd9X3BrZXlgKTtcbiAgdGhpcy5wdXNoUXVlcnkoYGFsdGVyIHRhYmxlICR7dGhpcy50YWJsZU5hbWUoKX0gYWRkIGNvbnN0cmFpbnQgJHtjb25zdHJhaW50TmFtZX0gcHJpbWFyeSBrZXkgKCR7dGhpcy5mb3JtYXR0ZXIuY29sdW1uaXplKGNvbHVtbnMpfSlgKTtcbn07XG5UYWJsZUNvbXBpbGVyX1BHLnByb3RvdHlwZS51bmlxdWUgPSBmdW5jdGlvbihjb2x1bW5zLCBpbmRleE5hbWUpIHtcbiAgaW5kZXhOYW1lID0gaW5kZXhOYW1lID8gdGhpcy5mb3JtYXR0ZXIud3JhcChpbmRleE5hbWUpIDogdGhpcy5faW5kZXhDb21tYW5kKCd1bmlxdWUnLCB0aGlzLnRhYmxlTmFtZVJhdywgY29sdW1ucyk7XG4gIHRoaXMucHVzaFF1ZXJ5KGBhbHRlciB0YWJsZSAke3RoaXMudGFibGVOYW1lKCl9IGFkZCBjb25zdHJhaW50ICR7aW5kZXhOYW1lfWAgK1xuICAgICcgdW5pcXVlICgnICsgdGhpcy5mb3JtYXR0ZXIuY29sdW1uaXplKGNvbHVtbnMpICsgJyknKTtcbn07XG5UYWJsZUNvbXBpbGVyX1BHLnByb3RvdHlwZS5pbmRleCA9IGZ1bmN0aW9uKGNvbHVtbnMsIGluZGV4TmFtZSwgaW5kZXhUeXBlKSB7XG4gIGluZGV4TmFtZSA9IGluZGV4TmFtZSA/IHRoaXMuZm9ybWF0dGVyLndyYXAoaW5kZXhOYW1lKSA6IHRoaXMuX2luZGV4Q29tbWFuZCgnaW5kZXgnLCB0aGlzLnRhYmxlTmFtZVJhdywgY29sdW1ucyk7XG4gIHRoaXMucHVzaFF1ZXJ5KGBjcmVhdGUgaW5kZXggJHtpbmRleE5hbWV9IG9uICR7dGhpcy50YWJsZU5hbWUoKX0ke2luZGV4VHlwZSAmJiAoYCB1c2luZyAke2luZGV4VHlwZX1gKSB8fCAnJ31gICtcbiAgICAnICgnICsgdGhpcy5mb3JtYXR0ZXIuY29sdW1uaXplKGNvbHVtbnMpICsgJyknKTtcbn07XG5UYWJsZUNvbXBpbGVyX1BHLnByb3RvdHlwZS5kcm9wUHJpbWFyeSA9IGZ1bmN0aW9uKGNvbnN0cmFpbnROYW1lKSB7XG4gIGNvbnN0cmFpbnROYW1lID0gY29uc3RyYWludE5hbWUgPyB0aGlzLmZvcm1hdHRlci53cmFwKGNvbnN0cmFpbnROYW1lKSA6IHRoaXMuZm9ybWF0dGVyLndyYXAodGhpcy50YWJsZU5hbWVSYXcgKyAnX3BrZXknKTtcbiAgdGhpcy5wdXNoUXVlcnkoYGFsdGVyIHRhYmxlICR7dGhpcy50YWJsZU5hbWUoKX0gZHJvcCBjb25zdHJhaW50ICR7Y29uc3RyYWludE5hbWV9YCk7XG59O1xuVGFibGVDb21waWxlcl9QRy5wcm90b3R5cGUuZHJvcEluZGV4ID0gZnVuY3Rpb24oY29sdW1ucywgaW5kZXhOYW1lKSB7XG4gIGluZGV4TmFtZSA9IGluZGV4TmFtZSA/IHRoaXMuZm9ybWF0dGVyLndyYXAoaW5kZXhOYW1lKSA6IHRoaXMuX2luZGV4Q29tbWFuZCgnaW5kZXgnLCB0aGlzLnRhYmxlTmFtZVJhdywgY29sdW1ucyk7XG4gIHRoaXMucHVzaFF1ZXJ5KGBkcm9wIGluZGV4ICR7aW5kZXhOYW1lfWApO1xufTtcblRhYmxlQ29tcGlsZXJfUEcucHJvdG90eXBlLmRyb3BVbmlxdWUgPSBmdW5jdGlvbihjb2x1bW5zLCBpbmRleE5hbWUpIHtcbiAgaW5kZXhOYW1lID0gaW5kZXhOYW1lID8gdGhpcy5mb3JtYXR0ZXIud3JhcChpbmRleE5hbWUpIDogdGhpcy5faW5kZXhDb21tYW5kKCd1bmlxdWUnLCB0aGlzLnRhYmxlTmFtZVJhdywgY29sdW1ucyk7XG4gIHRoaXMucHVzaFF1ZXJ5KGBhbHRlciB0YWJsZSAke3RoaXMudGFibGVOYW1lKCl9IGRyb3AgY29uc3RyYWludCAke2luZGV4TmFtZX1gKTtcbn07XG5UYWJsZUNvbXBpbGVyX1BHLnByb3RvdHlwZS5kcm9wRm9yZWlnbiA9IGZ1bmN0aW9uKGNvbHVtbnMsIGluZGV4TmFtZSkge1xuICBpbmRleE5hbWUgPSBpbmRleE5hbWUgPyB0aGlzLmZvcm1hdHRlci53cmFwKGluZGV4TmFtZSkgOiB0aGlzLl9pbmRleENvbW1hbmQoJ2ZvcmVpZ24nLCB0aGlzLnRhYmxlTmFtZVJhdywgY29sdW1ucyk7XG4gIHRoaXMucHVzaFF1ZXJ5KGBhbHRlciB0YWJsZSAke3RoaXMudGFibGVOYW1lKCl9IGRyb3AgY29uc3RyYWludCAke2luZGV4TmFtZX1gKTtcbn07XG5cbmV4cG9ydCBkZWZhdWx0IFRhYmxlQ29tcGlsZXJfUEc7XG4iXX0=